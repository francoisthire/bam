<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Gen (bam.Bam.Gen)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">bam</a> &#x00BB; <a href="../index.html">Bam</a> &#x00BB; Gen</nav><header class="odoc-preamble"><h1>Module <code><span>Bam.Gen</span></code></h1><p>Module defining what a random generator is.</p></header><nav class="odoc-toc"><ul><li><a href="#basic">Generators</a><ul><li><a href="#monad">A monadic interface</a></li><li><a href="#shrinking">Shrinking</a></li><li><a href="#merge">Advanced: Merging and shrinking</a></li><li><a href="#advanced">Advanced: Sequence of generators</a></li></ul></li></ul></nav><div class="odoc-content"><div class="odoc-spec"><div class="spec module anchored" id="module-Random"><a href="#module-Random" class="anchor"></a><code><span><span class="keyword">module</span> Random</span><span> : <span class="xref-unresolved">PRNG</span>.PURE</span></code></div><div class="spec-doc"><p>This module is similar to the <code>Random</code> module exposed by the standard library except it contains also a <code>split</code> function. This function exists in the <a href="Random/index.html"><code>Random</code></a> module of the standard library since OCaml 5.0. We use this one for compatibility with previous OCaml versions.</p></div></div><h2 id="basic"><a href="#basic" class="anchor"></a>Generators</h2><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p>Datatype for generators of type <code>'a</code>. A generator should be thought as a tree (or for some usage a sequence of tree (see <a href="#val-sequence"><code>sequence</code></a>). The root of the tree is the generated value. Children of the tree are &quot;smaller&quot; values that can be used during the shrinking.</p><p>While shrinking, it may be interesting to produce multiple values. This is why there is a <a href="#val-sequence"><code>sequence</code></a> function and this is why a generator is actually a sequence of trees. A typical use case is a shrinker for lists with the <code>Skip</code> strategy. Skipping an element of the list during the shrinking process is the same as producing two trees: one with the element and one without.</p><p>However, when calling <a href="#val-run"><code>run</code></a>, the generator should always be a single tree (a sequence of length one). It is only during the shrinking that sequences of more trees may appear. This invariant is not guaranteed by the type system (see <a href="#val-run"><code>run</code></a>).</p><p>To understand how shrinking works, you should have a look at <a href="../../shrinking.html" title="shrinking">A primer on shrinking</a>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-make"><a href="#val-make" class="anchor"></a><code><span><span class="keyword">val</span> make : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="xref-unresolved">Stdlib</span>.Seq.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>make root make_children</code> builds a generator out of a root value <code>root</code> and a function to make children from their father. This can build an infinite tree if the function <code>f</code> never returns an empty sequence.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-z_range"><a href="#val-z_range" class="anchor"></a><code><span><span class="keyword">val</span> z_range : <span><span class="optlabel">?root</span>:<span class="xref-unresolved">Z</span>.t <span class="arrow">&#45;&gt;</span></span> <span><span class="optlabel">?origin</span>:<span class="xref-unresolved">Z</span>.t <span class="arrow">&#45;&gt;</span></span> <span><span class="label">min</span>:<span class="xref-unresolved">Z</span>.t <span class="arrow">&#45;&gt;</span></span> <span><span class="label">max</span>:<span class="xref-unresolved">Z</span>.t <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Z</span>.t <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>z_range ?root ?shrink min max</code> returns a generator producing a uniform value between <code>min</code> (inclusive) and <code>max</code> (exclusive). It shrinks towards the value <code>origin</code> using a binary search (see <code>Tree.binary_search</code>. By default <code>origin</code> is <code>0</code> if <code>0</code> is in the interval <code>min;max</code>. Otherwise <code>origin</code> is set to <code>min</code>.</p><p>If <code>root</code> is specified, the value returned is <code>root</code> with the same shrinking tree as if the random generator had produce this value.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-float_range"><a href="#val-float_range" class="anchor"></a><code><span><span class="keyword">val</span> float_range : 
  <span><span class="optlabel">?root</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?exhaustive_search_digits</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?precision_digits</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?origin</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">min</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">max</span>:float <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span>float <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>float_range ?root ?shrink min max</code> returns a generator producing a value between <code>min</code> (inclusive) and <code>max</code> (exclusive). It shrinks towards the value <code>min</code> using a binary search (see <code>Tree.binary_search</code>. The generator is not uniform. In particular when the fractional part of <code>min</code> and <code>max</code> are getting closer to <code>0.5</code>, the generator may tend to create more values equal to <code>min</code> or <code>max</code>. If the fractional part is <code>0.</code>, it should be uniform.</p><p>If <code>root</code> is specified, the value returned is <code>root</code> with the same shrinking tree as if the random generator had produce this value.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span><span class="optlabel">?on_failure</span>:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../Tree/index.html#type-t">Tree.t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Random</span>.t <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="../Tree/index.html#type-t">Tree.t</a></span></span></code></div><div class="spec-doc"><p><code>run ?on_failure gen state</code> runs the generator <code>gen</code> on the <code>state</code> given in parameter. It is expected that the generator returns only a single tree. This is always true except if the generator used <a href="#val-sequence"><code>sequence</code></a>. See its documentation for more details.</p></div></div><h3 id="monad"><a href="#monad" class="anchor"></a>A monadic interface</h3><div class="odoc-spec"><div class="spec value anchored" id="val-return"><a href="#val-return" class="anchor"></a><code><span><span class="keyword">val</span> return : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>return v</code> returns a generator generating the value <code>v</code>. There is no shrinking defined for this generator.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bind"><a href="#val-bind" class="anchor"></a><code><span><span class="keyword">val</span> bind : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>bind gen f</code> returns a new generator out of a generator and a function taking a value produce by this generator and return a new generator.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>map f gen</code> is an alias for <code>bind gen (fun x -&gt; return (f x))</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-root"><a href="#val-root" class="anchor"></a><code><span><span class="keyword">val</span> root : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>root gen f</code> is similar to bind, except that the value given to <code>f</code> is always the root of <code>gen</code> (if the sequence has more than one element, it is the root of the first tree which is taken).</p><p>As a result, this new generator forgets completely the other values of <code>gen</code>. It acts as if it contains only the root.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-of_seq"><a href="#val-of_seq" class="anchor"></a><code><span><span class="keyword">val</span> of_seq : <span><span><span class="type-var">'a</span> <span class="xref-unresolved">Stdlib</span>.Seq.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>of_seq seq</code> returns a generator that will produce successively the values of the sequence until the sequence is empty.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Syntax"><a href="#module-Syntax" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Syntax/index.html">Syntax</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><h3 id="shrinking"><a href="#shrinking" class="anchor"></a>Shrinking</h3><div class="odoc-spec"><div class="spec value anchored" id="val-shrink"><a href="#val-shrink" class="anchor"></a><code><span><span class="keyword">val</span> shrink : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'ok</span>, <span class="type-var">'err</span>)</span> <span class="xref-unresolved">Stdlib</span>.Result.t</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="../Tree/index.html#type-t">Tree.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>shrink tree f</code> returns a value <code>a</code> that has the following specification assuming <code>f</code> is deterministic and <code>f tree.root</code> is <code>Error _</code>:</p><ul><li><code>f a = Error _</code></li></ul><ul><li><code>path(a,tree.root) = true</code></li></ul><ul><li>forall v, if <code>v \in path(a, tree.root)</code> then <code>f v = Error _</code></li></ul><ul><li>if <code>v' = left(v)</code> and <code>v \in path(a, tree.root)</code> then <code>f v = Ok _</code></li></ul><p>where:</p><ul><li><code>path(a,b)</code> returns <code>true</code> if there is a path in the tree from node <code>a</code> to node <code>b</code>.</li></ul><ul><li><code>left a</code> is the node <code>b</code> such that <code>a</code> and <code>b</code> have the same parent, and <code>a</code> is the successor of <code>b</code> when iterating children.</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-crunch"><a href="#val-crunch" class="anchor"></a><code><span><span class="keyword">val</span> crunch : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>crunch i gen</code> returns a generator with the same root but a more aggressive shrinking strategy. It crunchs the first <code>i</code> levels of the tree into a single level. Hence, to be effective <code>i</code> must be greater or equal to <code>2</code> since <code>i=0</code> is the root and <code>i=1</code> is the first row that can't be crunched.</p></div></div><h3 id="merge"><a href="#merge" class="anchor"></a>Advanced: Merging and shrinking</h3><div class="odoc-spec"><div class="spec module anchored" id="module-Merge"><a href="#module-Merge" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Merge/index.html">Merge</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The bind function needs to be able to merge nodes between two trees. This library allows you to override the default behaviour be defining your own merge function. The function <a href="#val-with_merge"><code>with_merge</code></a> aims to be used just before the next bind.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-with_merge"><a href="#val-with_merge" class="anchor"></a><code><span><span class="keyword">val</span> with_merge : <span><span><span class="type-var">'a</span> <a href="Merge/index.html#type-t">Merge.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>with_merge merge gen</code> sets a new merging strategy for the generator.</p></div></div><h3 id="advanced"><a href="#advanced" class="anchor"></a>Advanced: Sequence of generators</h3><p>The function <a href="#val-sequence"><code>sequence</code></a> takes advantage of the fact that a generator can be actually a sequence of trees also known as &quot;forest&quot;. <a href="#val-bind"><code>bind</code></a> will always try to make a single tree out of two trees, however some shrinking strategies require to keep the two separetely. This is the case of the <code>Skip</code> strategy for <code>list</code> allowing to skip some elements of the list. While for the initial value, we expect a single tree, for example <code>1;3;5;7</code>, during the shrinking we may want to explore the tree associated to sublists such as <code>1;3</code> or <code>3;5</code>. This is cannot be achieved easily with <a href="#val-bind"><code>bind</code></a>.</p><p>In that case, during the shrinking process, we need to generate multiple trees corresponding to different sublists. This is the purpose of the <a href="#val-sequence"><code>sequence</code></a> function.</p><div class="odoc-spec"><div class="spec value anchored" id="val-sequence"><a href="#val-sequence" class="anchor"></a><code><span><span class="keyword">val</span> sequence : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="xref-unresolved">Stdlib</span>.Seq.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>sequence gen seq</code> returns a new generator out of a non-empty sequence of generators <code>gen::seq</code>. This function aims to be used to define better shrinking strategies. This means that we should never have: <code>bind gen (fun x -&gt; ... (sequence gen seq))</code> such that <code>seq</code> is not empty when <code>x</code> is the originate value of the generator <code>gen</code>. It should only happen when <code>x</code> is a smaller value generated via the shrinking.</p></div></div></div></body></html>
